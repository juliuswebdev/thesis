<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>BAMOS FORGOT PASSWORD</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">


  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!--CSS-->

  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <link href="assets/css/style.css" rel="stylesheet">

</head>

<body>

  <!--HEADER-->
  <header id="header" class="fixed-top ">
    <div class="container d-flex align-items-center justify-content-lg-between">
    

      <h1 class="logo me-auto me-lg-0"><a href="">BAMOS<span>.</span></a></h1>


      

      <a href="index.html" class="get-started-btn scrollto">LOG IN</a>

    </div>
  </header>

   
  <section class="vh-100 gradient-custom">
    <div class="container py-5 h-100">
      <div class="row d-flex justify-content-center align-items-center h-100">
        <div class="col-12 col-md-8 col-lg-6 col-xl-5">
          <div class="card">
            <div class="card-body p-4 text-center">
  
              <div class="mb-md-10 mt-md-12 pb-15">
  
                <h2>RESET PASSWORD</h2>
                <p class="text-white-50 mb-5">Please enter your phone number to reset your password.</p>
  
                <div class="form-outline form-white mb-4">
                  <input type="email" id="phoneNum" class="form-control form-control-lg" value="09" />
                  <label class="form-label" for="phoneNum">Phone number</label>
                  <br>
                  <button class="btn btn-outline-light btn-lg px-5" onclick="generateOTP()">Send Code</button>
                </div>

                <div class="form-outline form-white mb-4">
                  <input type="text" id="code" class="form-control form-control-lg" />
                  <label class="form-label" for="code">Code</label>
                  <span id = "otp" style="color:red; display: none;"> </span>
                </div>
  
                <div class="form-outline form-white mb-4">
                  <input type="password" id="password" class="form-control form-control-lg" />
                  <label class="form-label" for="password">New password</label>
                  <span id = "passwordLabel" style="color:red; display: none;"> </span>
                </div>

                <div class="form-outline form-white mb-4">
                  <input type="password" id="repassword" class="form-control form-control-lg" />
                  <label class="form-label" for="repassword">Re-enter new password</label>
                  <span id = "rePasswordLabel" style="color:red; display: none;"> </span>
                </div>
  
                <button onclick="changePassword()" class="btn btn-outline-light btn-lg px-5" type="submit"> Submit</button>

                <div class="d-flex justify-content-center text-center mt-4 pt-1">
                  <a href="#!" class="text-white"><i class="fab fa-facebook-f fa-lg"></i></a>
                  <a href="#!" class="text-white"><i class="fab fa-twitter fa-lg mx-4 px-2"></i></a>
                  <a href="#!" class="text-white"><i class="fab fa-google fa-lg"></i></a>
                </div>
              </div>
  
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <main id="main">

  <!--Footer-->
  <footer id="footer">
    <div class="footer-top">
      <div class="container">
        <div class="row">

         
          
    <div class="container">
      <div class="copyright">
        &copy; Copyright <strong><span>BAMOS</span></strong>. All Rights Reserved
      </div>
      <div class="credits">
       
      </div>
    </div>
  </footer><!--End Footer-->

  <div id="preloader"></div>
  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>


  <script src="assets/js/main.js"></script>

</body>

<style>

.body{
  font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
}

.gradient-custom {
background: linear-gradient(to bottom, #b3b6b6, #A7D397 )
}

div.card{
  zoom: 100%;
  background-color: rgb(45, 53, 53);
  font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
  font-size: 1.1rem;
  color: #fff;
  border-radius: 20px;
}


#footer .copyright {
  text-align: center;
  padding-top: 0px;
}

#footer .credits {
  padding-top: 0px;
  text-align: center;
  font-size: 13px;
  color: #fff;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/twilio.js/1.2.0/twilio.min.js" integrity="sha512-EZb0O0PmyoxKEre0zjfVz47sLzYCPi27WxG9g/qva4QO9VBPongOGpFUbxDu/h8ViL7u5sRWGkVKpCkRiijceQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
<script>
  // Import the Supabase client
  // Replace 'YOUR_SUPABASE_URL' and 'YOUR_SUPABASE_KEY' with your Supabase project URL and API key
  const supabaseUrl = 'https://hzyiqzmdkocpumguttzb.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh6eWlxem1ka29jcHVtZ3V0dHpiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDA1Mzc5OTMsImV4cCI6MjAxNjExMzk5M30.-JNHzAkpBh_EN99ZiYGbu1q4ZsRSE3WapgBRMPrkiZs';

  // Create a Supabase client
  const database = supabase.createClient(supabaseUrl, supabaseKey);

  var otp = '';
  var user = null;

  async function generateOTP() {   

      // Check if phonenum exist
    const userPhoneNum = document.getElementById('phoneNum').value;

    const { data, error } = await database.from('testing').select().eq('phoneNum', userPhoneNum).limit(1);
    
    if(data.length > 0) {
      var digits = '0123456789'; 
      let OTP = ''; 
      for (let i = 0; i < 6; i++ ) { 
          OTP += digits[Math.floor(Math.random() * 10)]; 
      } 
      const accountSid = 'AC709689f2d0e73739a3e14b117e6405f6';
      const authToken = '11fe6425a7c93c2c9267d8bd0435ebcd';
      otp = OTP; 
      user = data;
      $.ajax({
          type: 'POST',
          url: 'https://api.twilio.com/2010-04-01/Accounts/' + accountSid + '/Messages.json',
          data: {
              "To" : userPhoneNum.replace('09', '+639'),
              "From" : "+14157693206",
              "Body" : "OTP Code: " + otp 
          },
          beforeSend: function (xhr) {
              xhr.setRequestHeader ("Authorization", "Basic " + btoa(accountSid + ':' + authToken));
          },
          success: function(data) {
          },
          error: function(data) {
          }
      });
    } else {
      alert('Phone number not found in database');
    }

      
  } 

  async function changePassword() {
    const userPhoneNum = document.getElementById('phoneNum').value;
    const userCode = document.getElementById('code').value;
    const userPassword = document.getElementById('password').value;
    const userRePassword = document.getElementById('repassword').value;

    if(validateForm()) {
      if(otp != userCode) {
        document.getElementById("otp").innerHTML = "**Invalid OTP!";  
        document.getElementById("otp").style.display = "block";
      } else {
        const { data } = await database
          .from('testing')
          .update({ password: userRePassword })
          .eq('phoneNum', userPhoneNum);
          alert('Successfully Password Changed!');
      }
    } 
  }

  function validateForm() {  
    //collect form data in JavaScript variables  
    var pw1 = document.getElementById("password").value;  
    var pw2 = document.getElementById("repassword").value;    
    document.getElementById("passwordLabel").style.display = "none";
    document.getElementById("rePasswordLabel").style.display = "none";
    //check empty password field  
    if(pw1 == "") {  
      document.getElementById("passwordLabel").innerHTML = "**Fill the password please!";  
      document.getElementById("passwordLabel").style.display = "block";
      return false;  
    }  
    
    //check empty confirm password field  
    if(pw2 == "") {  
      document.getElementById("rePasswordLabel").innerHTML = "**Enter the password please!"; 
      document.getElementById("rePasswordLabel").style.display = "block"; 
      return false;  
    }   
     
    //minimum password length validation  
    if(pw1.length < 8) {  
      document.getElementById("passwordLabel").innerHTML = "**Password length must be atleast 8 characters"; 
      document.getElementById("passwordLabel").style.display = "block";  
      return false;  
    }  
  
    //maximum length of password validation  
    if(pw1.length > 15) {  
      document.getElementById("passwordLabel").innerHTML = "**Password length must not exceed 15 characters";  
      document.getElementById("passwordLabel").style.display = "block";  
      return false;  
    }  
    
    if(pw1 != pw2) {  
      document.getElementById("rePasswordLabel").innerHTML = "**Passwords are not same";  
      document.getElementById("rePasswordLabel").style.display = "block";
      return false;  
    } else {  
      return true;
    }  
 }  

</script>

</html> 